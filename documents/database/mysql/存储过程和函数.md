[TOC]

存储过程和函数是实现经过编译并且存储在数据库中的一段sql语句的集合。

两者的区别在于函数必须有返回值，而存储过程没有，存储过程的参数可以使用in、out、inout类型，而函数的参数只能是in类型。



# 1. 创建

## 1.1 创建存储过程

```
create procedure 存储过程名 (参数...) 过程体
```



## 1.2 创建函数

```
create function 函数名 (参数...) 函数体
```



## 1.3 示例

创建一个存储过程

```
delemiter $$ 

create procedure myDemo(in user_id int) 
reads sql data
begin 
    select username from SysUser where id = user_id 
end $$ 

delemiter ;
```



# 2. 修改

## 2.1 修改存储过程

```
alter procedure 存储过程名 (参数...) 过程体
```



## 2.2 修改函数

```
alter function 函数名 (参数...) 函数体
```



# 3. 删除

## 3.1 删除存储过程

```
drop procedure 存储过程名
```



## 3.2 删除函数

```
drop function 函数名
```



# 4. 查看

## 4.1 查看存储过程状态

```
show procedure status like ‘存储过程名’ \G
```



## 4.2 查看函数状态

```
show function status like ‘函数名’ \G
```



## 4.3 查看存储过程定义

```
show create procedure 存储过程名 \G
```



## 4.4 查看函数定义

```
show create function 函数名 \G
```



# 5 使用变量

通过declare可以定义一个局部变量，该变量的作用范围只能在 begin...end 块中，可以用在嵌套的块中。变量的定义必须写在复合语句的开头，并且在任何其他语句的前面，可以一次声明多个相同类型的变量，可以使用default赋默认值。



## 5.1 定义变量

```
declare 变量名 数据类型 [default 默认值]
```



## 5.2 变量赋值

```
set 变量名 = 值或表达式
```



## 5.3 将查询结果赋给变量

```
select 列名 into 变量名 ...
```



# 6 使用条件

## 6.1 定义条件

```
declare 条件名 condition for 条件值
```



## 6.2 处理条件

```
declare continue|exit handler for 条件值
```



# 7 流程控制

## 7.1 if 语句

```
if 条件 then 动作 
    [elseif 条件 then 动作]... 
    [else 动作] 
end if
```



## 7.2 case 语句

```
case 条件: 
    when 条件值 then 动作 
    [when 条件值 then 动作]... 
    [else 动作] 
end case 
或 
case: 
    when 条件 then 动作 
    [when 条件 then 动作]... 
    [else 动作] 
end case
```



## 7.3 loop 语句

```
[循环标签名:]loop 
    动作 
end loop [循环标签名]
```



## 7.4 leave 语句

通常在循环体中使用，退出循环

```
leave 循环标签名
```



## 7.5 iterate 语句

通常在循环体中使用，跳过当前循环中剩下的语句，直接进入下一次循环。

```
iterate 循环标签名
```



## 7.6 repeat 语句

repeat至少会执行一次，因为其是在第一次动作执行完成后才判断条件。

```
[循环标签名:]repeat 
    动作 
    until 条件 
end repeat [循环标签名]
```



## 7.7 while 语句

while至少执行0次，因为其在动作执行前就进行判断。

```
[循环标签名:]while 条件 do 
    动作 
end while [循环标签名]
```



# 8 事件调度器

## 8.1 创建

事件调度器创建完成后默认是关闭的.

```
create event 事件名称 on schedule 触发条件 do 动作
```



## 8.2 查看状态

```
show variables like ‘事件名称’
```



## 8.3 开启

```
set global 事件名称 = 1
```



## 8.4 关闭

```
alter event 事件名称 disable
```



## 8.5 删除

```
drop event 事件名称
```