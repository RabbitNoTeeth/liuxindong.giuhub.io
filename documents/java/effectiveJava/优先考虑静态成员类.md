[TOC]

嵌套类是指被定义在另一个类的内部的类。嵌套类存在的目的应该只是为它的外围类提供服务，如果嵌套类将来可能用于其他环境中，它就应该是顶层类。

嵌套类有四种：静态成员类、非静态成员类、匿名类和局部类。除了第一种，其他三种都被成为内部类、

# 1 静态成员类

静态成员类是最简单的一种嵌套类，最好把它看成是普通的类，只是碰巧被声明在另一个类的内部而已，它可以访问外围类的所有成员，包括那些被声明为私有的成员。

静态成员类的一种常见用法是作为共有的辅助类，仅当与它的外部类一起使用时才有意义。

私有静态成员类的一种常见用法是用来代表外围类所代表的对象的组件，如Map中的Entry。



# 2 非静态成员类

非静态成员类的每个实例都隐含着与外围类的一个外围实例相关联。在非静态成员类的实例方法内部，可以调用外围实例上的方法，或者使用修饰过的this构造获得外围实例的引用。如果嵌套类的实例可以在它外围类的实例之外独立存在，那么这个嵌套类就必须是静态成员类。

非静态成员类的一种常见用法是定义一个Adapter，它允许外部类的实例被看作是另一个不相关的类的实例。

如果声明成员类不需要访问外围实例，那么就要始终把static修饰符放在它的声明中，使它成为静态成员类。如果省略了static，则每个实例都将包含一个额外的指向外围对象的引用。保存这份引用要消耗时间和空间，并且会导致外围类在符合垃圾回收时却仍然得以保留。



# 3 匿名类

匿名类没有名称，它不是外围类的一个成员，它不与其他成员一起被声明，而是在使用的同时被声明和实例化。匿名类可以出现在代码中任何允许表达式的地方。当且仅当匿名类出现在非静态的环境中时，它才有外围实例。但是即使它们出现在静态的环境中，也不可能拥有任何的静态成员。



匿名类的限制：

1. 除了在它们被声明的时候之外，是无法将它们实例化的。
2. 不能执行instanceof测试，或者做任何需要命名类的其他事情。
3. 无法声明一个匿名类来实现多个接口，或者扩展一个类，并同时扩展类和接口。
4. 匿名类的客户端无法调用任何成员，除了从它的超类型中继承得到之外。
5. 必须保持简短。



匿名类的一种常见用法是动态地创建函数对象。或者创建过程对象，如Runnable、Callable等(在java8引入了lambda和函数式接口后，可以使用lambda来代替匿名类)。



# 4 局部类

局部类是四中嵌套类中使用最少的类。任何可以声明局部变量的地方，都可以声明局部类。

局部类有名字，可以被重复地使用。只有当局部类在非静态环境中定义的时候，才有外围实例，它们也不能包含静态成员，必须非常简短，以免影响可读性。



# 小结

如果一个嵌套类需要在单个方法之外仍是可见的，或者它太长了，不适合放在方法内部，就应该使用成员类。

如果成员类的每个实例都需要一个指向其外围类的实例的引用，就把成员类做成非静态的，否则就做成静态的。

假设这个嵌套类属于一个方法的内部，如果你只需要在一个地方创建实例，并且已经有了一个预置的类型可以说明这个类的特征，就把它做成匿名类。否则就做成局部类。