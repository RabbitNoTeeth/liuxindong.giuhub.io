[TOC]

在之前的章节中，对于JVM运行时，只涉及到了java堆，其实Java虚拟机所管理的内存包括以下几个运行时区域：

# 1 程序计数器

程序计数器是一块较小的内存空间，可以把它看作是当前线程所执行的字节码的行号指示器。字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。

**线程私有**，每条线程都有一个独立的程序计数器，用于记录线程当前执行的字节码的位置，各条线程之间计数器互不影响。

该内存区域是**唯一一个在jvm规范中没有规定任何OutOfMemoryError情况的区域**。



# 2 栈

**线程私有，它的生命周期与线程相同。**

虚拟机栈描述的是java方法执行的内存模型：每个方法在执行的同时都会创建一个栈帧，用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每一个方法从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。

局部变量表存放了编译期可知的各种基本数据类型和对象引用类型。其中double和long类型占用2个局部变量空间，其他类型占用1个。**局部变量表所需要的内存空间在编译期完成分配，在方法运行期间不会改变局部变量表的大小**。

如果线程请求的栈深度大于虚拟机允许的深度，抛出StackOverflowError异常； 如果虚拟机栈可以动态扩展，在扩展时无法申请到足够的内存时，抛出OutOfMemoryError异常。



# 3 本地方法栈

为虚拟机使用到Native方法服务。也会抛出StackOverflowError和OutOfMemoryError异常。



# 4 堆

不做赘述，详细了解可查看之前的相关章节。



# 5 方法区

各个**线程共享**的内存区域，用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。它有一个别名：非堆(Non-Heap)。

方法区不是永久代，只是对于HotSpot虚拟机来说，使用永久代来实现了方法区而已。当方法区无法满足内存分配的需求时，将抛出OutOfMemoryError异常。

运行时常量池是方法区的一部分，用于存放编译期生成的各种字面量和符号引用。