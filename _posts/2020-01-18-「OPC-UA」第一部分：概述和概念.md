---
title: 「OPC-UA」第一部分：概述和概念
tags:
- OPC-UA
- OPC
- OPC统一架构
- GB／T 33863.1
---



# 1 OPC-UA 标准结构

![OPC UA 系列标准结构]({{ "assets/illustration/20200118/opc-ua_biaozhunjiegou.png" | absolute_url }})



# 2 OPC-UA 标准简介

## 2.1 UA范围

OPC UA可用于现场设备、控制系统、制造执行系统和企业资源管理系统等应用领域的制造业软件。OPC UA定义了通用架构模型以帮助实现不同领域软件间的信息交互，OPC UA规定如下内容：

- 表示结构、行为和语义的信息模型
- 在应用间交互的消息模型
- 在端点间传输数据的通信模型
- 确保系统间互操作的一致性模型



## 2.2 概述

OPC UA是一个平台无关的标准，使用该标准可在位于不同类型网络上的客户端和服务端间发送消息，以实现不同类型系统和设备间通信。

OPC UA定义了服务器可提供的服务集，以及针对客户端所规定的每个服务器支持的服务集。

使用OPC UA定义的数据类型、制造商定义的数据类型来传递消息，客户端能动态发现的对象模型由服务器定义。服务器能提供对当前数据和历史数据的访问以及对报警和事件的访问，以向客户端通知重要变化。

***OPC UA可被映射到不同的通信协议，并按数据可按不同方式进行编码以平衡可移植性和效率。***



## 2.3 设计目标

OPC UA提供一致的、集成的地址空间和服务模型，这允许一个OPC UA服务器将数据、报警、事件和历史数据集成到地址空间，并使用集成的服务集对其进行访问。

OPC UA允许服务器向客户端提供从地址空间访问的对象类型定义，也允许使用信息模型描述地址空间内容。***允许数据按照不同格式表示，包括二进制结构和xml文件。数据格式可由OPC、其他标准组织或制造商定义。***通过地址空间，客户端能向服务端查询描述数据格式的元数据，在许多情况下，没有数据格式的预编程序知识的客户端，能实时确定数据格式并适当地使用数据。

OPC UA补充了对节点间多种关联的支持，而不是限定为一种层次结构，服务器可按不同的经剪裁的层次结构表示数据，使得客户端能按喜欢的方式浏览数据。

![OPC UA 目标应用]({{ "assets/illustration/20200118/opc-ua_mubiaoyingyong.png" | absolute_url }})

OPC UA被设计为可提供健壮的发布数据。所有OPC服务器的主要特点是具有发布数据和事件通知的能力。OPC UA为客户端提供可实现快速检测并与传输相关联的通信故障中恢复的机制，而无需等待底层协议提供的长超时。

OPC UA被设计为支持更广泛意义上的服务器，从工业底层的PLC到企业服务器。并且OPC UA定义了详尽的能力集，服务器可实现这些能力中的一个子集。为提高互操作性，OPC UA定义了子集，成为行规，服务器可声明其符合哪种行规，客户端能发现服务器的行规，并基于行规调整其与服务器交互。

将OPC UA规范形成层次关系，以实现将核心设计与底层计算技术和网络传输分离。这允许在需要时将OPC UA映射到将来的技术上，而无需取消基础设计。



## 2.4 集成模型和服务

### 2.4.1 安全模型

#### 2.4.1.1 概述

OPC UA安全主要涉及对客户端和服务端鉴别、用户鉴别、通信完整性和机密性，以及对功能声明的验证。

OPC UA安全没有规定不同安全机制要求的环境，可由系统设计人员在给定的地点规定，也可由其他标准规定。



#### 2.4.1.2 发现和建立会话

应用层面的安全取决于在应用会话期间激活的安全通信通道，可确保所有交互消息的完整性。

当建立会话时，客户端和服务端应用协商确定安全通信通道，并交换识别客户端、服务器及所提供能力的软件证书。授权产生的软件证书指示应用实现的OPC UA行规，以及每个行规达到的OPC UA证书等级。

服务器对用户进行鉴别，并批准后续请求访问服务器中的对象。***授权机制，如访问控制列表，是应用或系统特定的，不是由OPC UA规范规定。***



#### 2.4.1.3 审核

OPC UA通过客户端和服务器审核日志的可溯源性，支持对安全审核的跟踪。如果在服务器侦测到安全相关问题，则相关联的客户端审核日志登录项可被定位和检查。

OPC UA也为服务器提供产生时间通知的能力，事件通知可向能处理和生成日志的客户端报告可审核事件。

OPC UA定义了可包含在审核日志登录项和审核时间通知的安全审核参数。



#### 2.4.1.4 传输安全

传输层面安全能用于加密和签名消息。加密能力由在OPC UA应用间交换消息的底层通信技术提供。



### 2.4.2 集成地址空间模型

OPC UA服务器提供给客户端可使用的对象集和相关信息称为地址空间。OPC UA地址空间将其内容表示为引用连接的节点集合。

节点的基本特性由OPC定义的属性来描述，在服务器中只有属性是有数值的元素。定义属性值的数据类型可能是简单的或复杂的。

地址空间的节点根据其用途和含义进行了分类，节点类为OPC UA定义了元数据。

基本节点类定义了所有节点通用的属性：允许标识、分类和命名。每个节点继承了这些属性并能定义自己的属性。

OPC UA地址空间按层级进行了划分，其顶层对于所有服务器都是相同的，节点间可按照层次结构访问，也可互相引用。



### 2.4.3 集成对象模型

为表示地址空间中的对象，OPC UA对象模型提供了一致的、集成的节点类集。该模型将对象表示为变量、事件、方法以及与其他对象的关系。

OPC UA对象模型允许服务器为对象和部件提供类型定义。***对象模型可由标准化组织、供应商或终端用户定义。***

本模型允许数据、报警、事件和历史记录集成到一个OPC UA服务器。例如：OPC UA服务器能将一个温度传感器表示为一个由温度值、报警参数集合和相应的报警限值集合组成的对象。



### 2.4.4 集成服务

OPC UA客户端和服务器间的接口定义为服务集。

OPC UA服务向客户端提供两种能力：允许客户端向服务器发送请求，以及从服务器接收响应。

OPC UA服务也允许客户端向服务器订阅通知。服务器使用通知报告发生的情况：报警、数据值变化、事件和程序执行结果等。

OPC UA消息可编码为XML文本或二进制格式，可使用多个底层传输，如TCP或HTTP。



### 2.4.5 会话

会话定义为客户端和服务器的逻辑连接。服务器可根据可用资源、许可限制和其他约束限制当前会话的数量。每个会话与底层通信协议无关，这些协议的失效不会自动导致会话终止。客户端或服务器请求，或客户端未处于活动状态可终止会话。不活动时间间隔在会话建立过程中协商确定。



### 2.4.6 冗余

OPC UA设计确保供应商能按一致的模式产生冗余客户端和冗余服务器。冗余可用于高可用性、容错和载荷平衡。



# 3 系统概念

## 3.1 概述

OPC UA系统架构将客户端和服务器建模为交互伙伴。每个系统可以包含多个客户端和服务器。每个客户端可同时与一个或多个服务器交互，每个服务器可以与一个或多个客户端交互。一个应用也可以将服务器和客户端组合在一起。

![OPC UA 系统架构]({{ "assets/illustration/20200118/opc-ua_xitongjiagou.png" | absolute_url }})



## 3.2 客户端

![OPC UA 客户端架构]({{ "assets/illustration/20200118/opc-ua_kehuduanjiagou.png" | absolute_url }})

OPC UA客户端API是一个内部接口，用于分离客户端应用代码和OPC UA通信栈。当有客户端请求时，OPC UA通信栈将OPC UA客户端低啊用转换到消息中，通过底层通信实体将消息发送给服务器。OPC UA通信栈也接受来自底层通信实体的响应和通知消息，并通过OPC UA客户端API将消息传递给客户端应用。



## 3.3 服务器

### 3.3.1 概述

![OPC UA 服务器架构]({{ "assets/illustration/20200118/opc-ua_fuwuqijiagou.png" | absolute_url }})



### 3.3.2 实际对象

实际对象是OPC UA服务器应用可访问的，或OPC UA服务器内部维护的物理或软件对象。示例为物理设备和诊断计数器。



### 3.3.3 OPC UA服务器应用

OPC UA服务器应用是实现服务器功能的代码，可使用OPC UA服务器API发送和接受来自OPC UA客户端的OPC UA消息。注意：“OPC UA服务器API”是将服务器应用代码与OPC UA通信栈分离的内部接口。



### 3.3.4 OPC UA地址空间

#### 3.3.4.1 节点

地址空间是客户端使用OPC UA服务（接口或方法）可以访问的节点集。地址空间节点被用于表示实际对象、对象定义和对象间的引用。



#### 3.3.4.2 地址空间组织

IEC 62541-3包含元模型“构建块”的细节，该模型用于按一致方式产生互联节点的地址空间。服务器可在所选择的地址空间内自由地组织它们的节点。



#### 3.3.4.3 地址空间视图

视图是地址空间的子集。视图可用于服务器限制向客户端公开的节点，同时也限制了客户端发送的服务请求的地址空间范围。

缺省视图是整个地址空间。

服务器可以有选择地定义其他视图。

视图常为层次结构，这种结构使客户端更容易以树形结构来定位和表示。



#### 3.3.4.4 信息模型支持

OPC UA地址空间支持信息模型。该支持通过以下提供：

- 允许地址空间中对象建立彼此联系的节点引用
- 为实际对象（类型定义）提供语义信息的对象类型节点
- 支持类型定义的子类的对象类型节点
- 允许使用工业特定数据类型的地址空间中可见的数据类型定义
- 允许工业团体定义如何在OPC UA地址空间中表示其特定信息模型的OPC UA兼容标准



### 3.3.5 发布者/订阅者实体

#### 3.3.5.1 监视项

监视项是由客户端产生的服务器中的实体，用于监视地址空间节点和其在实际中对应项。当监视项侦测到数据变化或事件/报警发生时，应产生通知，并通过订阅传递给客户端。



#### 3.3.5.2 订阅

订阅是服务中向客户端发布通知的端点。客户端通过发送Publish（发布）消息控制发布发生的频率。



### 3.3.6 OPC UA服务器接口

#### 3.3.6.1 概述



#### 3.3.6.2 请求/响应服务

请求/响应服务是由客户端通过OPC UA服务接口调用的服务，以执行在地址空间中的一个或多个节点的特定任务，并返回响应。



#### 3.3.6.3 发布者服务

发布者服务是通过OPC UA服务器接口调用的，用于周期性地向客户端发送通知。通知包括事件、报警、数据交换和程序输出。



### 3.3.7 服务器和服务器的交互

在服务器与服务器之间的交互过程中，一个服务器作为另一个服务器的客户端。对于服务器的开发，服务器与服务器的交互允许：

- 以对等方式彼此间交换信息，包括：冗余或用于维护系统宽类型定义的远程服务器
- 在服务器分层结构中被链接以提供：
  - 来自底层服务器的数据聚合
  - 高层数据结构给客户端
  - 对客户端的集成接口，可通过一个访问点对多个底层服务器进行访问

![服务期间的对等交互]({{ "assets/illustration/20200118/opc-ua_fuwuqiduidengjiaohu.png" | absolute_url }})



下图对之前示例进行了扩展，给出了OPC UA服务器之间的链接，可用于企业内对数据的纵向访问。

![链接的服务器示例]({{ "assets/illustration/20200118/opc-ua_lianjiefuwuqishili.png" | absolute_url }})



# 4 服务集

## 4.1 概述

OPC UA服务被分成若干服务集，每个服务集定义了服务的逻辑分组，可用于访问服务器的特定部分。



## 4.2 发现服务集

该服务集定义了用于发现系统中使用的OPC UA服务器的服务，也提供客户端读取连接服务器所要求的的安全配置的方法。



## 4.3 安全通道服务集

该服务集定义了用于打开确保与服务器间交换的所有消息的保密性和完整性的通信通道。

通常该服务集不是由OPC UA应用直接实现，而是由OPC UA应用下层的通信栈提供。

安全通道独立于OPC UA应用会话，但一个OPC UA应用会话仅可能通过一个安全通道访问。

OPC UA应用使用通信栈交换信息，首先，安全通道服务用于在两个通信栈间建立安全通道，允许两个通信栈间以安全方式交换消息。其次，OPC UA应用使用会话服务集建立OPC UA应用会话。

![安全通道和会话服务]({{ "assets/illustration/20200118/opc-ua_anquantongdaohehuihuafuwu.png" | absolute_url }})



## 4.4 会话服务集

定义了在代表特定用户的会话中，建立应用层连接所使用的服务。



## 4.5 节点管理服务集

该服务集允许客户端添加、修改和删除地址空间的节点。



## 4.6 视图服务集

允许客户端通过浏览发现视图中的节点。



## 4.7 查询服务集

允许用户在不浏览也不了解内部存储数据的逻辑结构情况下，访问地址空间。



## 4.8 属性服务集

用于读写属性值。



## 4.9 方法服务集

方法表示对象的功能调用，调用完成后无论成功与否都要返回信息。

方法服务集定义了调用方法的手段。



## 4.10 监视项服务集

客户端使用该服务集建立和维护监视项。

监视项定义的采样频率可能比订阅的发布频率要快。为此，可将监视项配置为对所有通知排队或仅对订阅要传输的最新的通知排队。

监视项服务也定义监视模式。监视模式分为：禁止采样和报告、仅允许采样、允许采样和报告。



## 4.11 订阅服务集

客户端使用订阅服务建立和维护订阅。

通知消息包含通用头和其后的通知序列。通知格式对于监视项类型是特定的（变量、属性和事件通知）。

一旦产生订阅，订阅的存在就与客户端和服务端的会话无关。

为防止客户端不使用的订阅存在，订阅有一个可配置的生命周期，可由客户端定期更新。

订阅支持丢失消息侦测和回复的特性。每个通知消息包含允许客户端侦测丢失消息的序列号。当在保持活动的时间间隔内没有发送通知时，服务器发送保持活动消息，该消息包含下一个要发送的通知消息的序列号。如果客户端在保持活动间隔到期后没有收到消息，或已确定有丢失消息，客户端请求服务器再次发送一个或更多消息。
